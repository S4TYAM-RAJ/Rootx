<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RootX Inventory</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --blue:#007BFF;
      --blue-dark:#0056b3;
      --white:#ffffff;
      --text:#000;
      --card-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    html,body{height:100%;margin:0;background:var(--white);color:var(--text);font-family:Inter,Arial,Helvetica,sans-serif}
    header{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px 20px;
      position:relative;
      background:var(--white);
      box-shadow: 0 1px 0 rgba(0,0,0,0.04);
    }
    header h1{margin:0;font-size:20px;font-weight:700;color:var(--text);}

    #addBtn{
      position:fixed;
      right:18px;
      top:18px;
      width:40px;
      height:40px;
      border-radius:50%;
      border:none;
      background:var(--blue);
      color:var(--white);
      font-size:22px;
      line-height:1;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(0,123,255,0.12);
      z-index:60;
    }

    main{padding:20px;max-width:1100px;margin:0 auto;}

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
      gap:18px;
    }

    .card{
      background:var(--white);
      border-radius:12px;
      box-shadow:var(--card-shadow);
      border:1px solid rgba(0,0,0,0.04);
      overflow:hidden;
      aspect-ratio:1/1;
      display:flex;
      flex-direction:column;
      gap:12px;
      padding:14px;
    }

    .card .title{
      font-size:16px;
      font-weight:700;
      color:var(--text);
      padding:8px;
      background:rgba(0,123,255,0.06);
      border-radius:8px;
      text-align:left;
      width:100%;
      box-sizing:border-box;
    }

    .card .body{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:8px;
      padding-top:6px;
    }

    .meta{font-size:13px;color:var(--text);opacity:0.9;}
    .desc{font-size:13px;color:var(--text);line-height:1.2;max-height:4.6em;overflow:hidden}
    .linkRow{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .download{
      padding:8px 12px;
      background:var(--blue);
      color:var(--white);
      text-decoration:none;
      border-radius:8px;
      font-weight:600;
      font-size:13px;
    }
    .verified{
      font-size:20px;
      font-weight:700;
      color:var(--text);
    }

    footer{padding:18px;text-align:center;font-weight:700;color:var(--text);}

    #noteModalWrap{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      z-index:80;
    }
    #noteModal{
      width:320px;
      aspect-ratio:1/1;
      background:var(--white);
      border-radius:12px;
      box-shadow:var(--card-shadow);
      border:2px solid rgba(0,123,255,0.14);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:14px;
      padding:16px;
      text-align:center;
      pointer-events:auto;
    }
    #noteModal p{margin:0;color:var(--text);font-size:14px;line-height:1.4}
    #skipBtn{
      margin-top:6px;
      padding:8px 12px;
      border-radius:8px;
      border:none;
      background:var(--blue);
      color:var(--white);
      font-weight:700;
      cursor:not-allowed;
    }
    #skipBtn.active{cursor:pointer;background:var(--blue-dark);}

    #uploadPanel{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:90;
      pointer-events:none;
    }
    #uploadCard{
      width:320px;
      aspect-ratio:1/1;
      background:var(--white);
      border-radius:12px;
      box-shadow:var(--card-shadow);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:8px;
      pointer-events:auto;
    }
    #uploadCard h3{margin:0;font-size:16px;color:var(--text)}
    #uploadCard input,#uploadCard textarea{
      width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);font-size:13px;color:var(--text)
    }
    #uploadCard button{
      margin-top:auto;padding:10px;border-radius:8px;border:none;background:var(--blue);color:var(--white);font-weight:700;cursor:pointer
    }

    .note-warning{font-size:12px;color:var(--text);opacity:0.9}
  </style>
</head>
<body>
  <header>
    <h1>RootX Inventory</h1>
  </header>

  <button id="addBtn" title="Upload item">+</button>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <footer>TEAM ROOTX</footer>

  <div id="noteModalWrap" aria-hidden="true">
    <div id="noteModal" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
      <div style="width:100%;">
        <p id="noteTitle"><strong>NOTE</strong><br>All items here are uploaded by users — install only verified ones.<br><br>&#9989; = Verified &nbsp;&nbsp; &#10060; = Not Verified</p>
        <p class="note-warning">Warning: Uploading fake or malicious files may lead to permanent ban.</p>
      </div>
      <button id="skipBtn" disabled>Skip (5)</button>
    </div>
  </div>

  <div id="uploadPanel" style="display:none;">
    <div id="uploadCard" role="dialog" aria-modal="true" aria-labelledby="uploadTitle">
      <h3 id="uploadTitle">Upload Item</h3>
      <input id="titleIn" placeholder="Title (required)" />
      <textarea id="descIn" placeholder="Short description" rows="3"></textarea>
      <input id="linkIn" placeholder="Download Link (https://...)" />
      <div class="note-warning">Uploading fake/malware may result in permanent ban.</div>
      <button id="submitBtn">Upload</button>
      <button id="cancelUpload" style="margin-top:6px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer;">Cancel</button>
    </div>
  </div>

  <script>
    const API_KEY = "$2a$10$5TyPwxtO8pS6G5qBROpTx.PX3NTZx3bg/W6cnelH2J5Qzyfz27ZA.";
    const BIN_ID = "68c2ad3243b1c97be93f3c9f";

    const grid = document.getElementById('grid');
    const noteWrap = document.getElementById('noteModalWrap');
    const skipBtn = document.getElementById('skipBtn');
    const addBtn = document.getElementById('addBtn');
    const uploadPanel = document.getElementById('uploadPanel');
    const submitBtn = document.getElementById('submitBtn');
    const cancelUpload = document.getElementById('cancelUpload');

    function renderCard(item){
      const card = document.createElement('div');
      card.className = 'card';
      const title = `<div class="title">${escapeHtml(item.Title || item.title || '')}</div>`;
      const body = document.createElement('div');
      body.className = 'body';
      body.innerHTML = `
        <div>
          <div class="desc">${escapeHtml(item.Description || item.description || '')}</div>
        </div>
        <div>
          <div class="meta"><strong>Date:</strong> ${escapeHtml(item.Date || item.date || '')}</div>
          <div class="linkRow" style="margin-top:8px;">
            <a class="download" href="${escapeAttr(item.Link || item.link || '#')}" target="_blank" rel="noopener">Download</a>
            <div class="verified">${(item.Verified || item.verified || 'N') === 'V' ? '&#9989;' : '&#10060;'}</div>
          </div>
        </div>
      `;
      card.innerHTML = title;
      card.appendChild(body);
      return card;
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function escapeAttr(s){ if(!s) return '#'; return s.replaceAll('"','&quot;').replaceAll("'",'&#39;'); }

    async function loadInventory(){
      grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text);opacity:0.6">Loading...</div>';
      try{
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": API_KEY } });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        let items = [];
        if (data && data.record) {
          if (Array.isArray(data.record)) items = data.record;
          else if (Array.isArray(data.record.items)) items = data.record.items;
          else if (Array.isArray(data.record.inventory)) items = data.record.inventory;
          else if (Array.isArray(data.record.data)) items = data.record.data;
          else { for(const k in data.record) if(Array.isArray(data.record[k])) { items = data.record[k]; break; } }
        }
        grid.innerHTML = '';
        if(items.length === 0){
          grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text);opacity:0.6">No items found.</div>';
          return;
        }
        items.forEach(it => grid.appendChild(renderCard(it)));
      }catch(err){
        grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text);opacity:0.6">Failed to load inventory.</div>';
        console.error('loadInventory error', err);
      }
    }

    function showNote(){
      noteWrap.style.pointerEvents = 'auto';
      noteWrap.querySelector('#noteModal').style.display = 'flex';
      let c = 5;
      skipBtn.textContent = `Skip (${c})`;
      skipBtn.disabled = true;
      const t = setInterval(()=>{
        c--;
        skipBtn.textContent = c>0 ? `Skip (${c})` : 'Skip';
        if(c<=0){
          clearInterval(t);
          skipBtn.disabled = false;
          skipBtn.classList.add('active');
          skipBtn.onclick = ()=>{ noteWrap.style.display='none'; };
        }
      },1000);
    }

    async function submitItem(){
      const title = document.getElementById('titleIn').value.trim();
      const desc = document.getElementById('descIn').value.trim();
      const link = document.getElementById('linkIn').value.trim();
      if(!title || !link){ alert('Title and Link required'); return; }

      // ✅ Only allow full MediaFire links
      const mediafireRegex = /^https:\/\/www\.mediafire\.com\/file\/[A-Za-z0-9]+\/[^\/]+\/file$/;
      if(!mediafireRegex.test(link)){
        alert('Only full MediaFire file links are allowed!');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Uploading...';

      try{
        const getRes = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": API_KEY } });
        if(!getRes.ok) throw new Error('GET failed ' + getRes.status);
        const getData = await getRes.json();
        let rootObj = {};
        if(Array.isArray(getData.record)) { rootObj.items = getData.record; } 
        else if(getData.record && typeof getData.record === 'object') { rootObj = getData.record; rootObj.items = rootObj.items || []; } 
        else { rootObj.items = []; }

        rootObj.items.push({
          Title: title,
          Description: desc,
          Date: new Date().toLocaleDateString(),
          Link: link,
          Verified: "N"
        });

        const putRes = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
          body: JSON.stringify(rootObj)
        });
        if(!putRes.ok) throw new Error('PUT failed ' + putRes.status);

        alert('Success | Verification Required');
        uploadPanel.style.display = 'none';
        clearUploadInputs();
        await loadInventory();
      }catch(err){
        console.error('submitItem error', err);
        alert('Upload failed. Check Network or contact us.');
      }finally{
        submitBtn.disabled = false;
        submitBtn.textContent = 'Upload';
      }
    }

    function clearUploadInputs(){
      document.getElementById('titleIn').value = '';
      document.getElementById('descIn').value = '';
      document.getElementById('linkIn').value = '';
    }

    addBtn.addEventListener('click', ()=> { uploadPanel.style.display = 'flex'; });
    cancelUpload.addEventListener('click', ()=>{ uploadPanel.style.display = 'none'; });
    submitBtn.addEventListener('click', submitItem);

    window.addEventListener('load', ()=>{
      loadInventory();
      showNote();
    });
  </script>
</body>
</html>